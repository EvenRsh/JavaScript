<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Teste3</title>
    <style>
        table {
            border-collapse: collapse;
            font-size: xx-large;
        }
        th, td {
            border: 1px solid silver;
        }
        .tr {
            background-color: yellow;
        }
    </style>
    <script>
        window.onload = function () {
            var table = document.getElementById('table');
            var input = document.getElementsByTagName('input');

            table.onclick = function (e) {
               if (e.target.tagName.toLowerCase() === 'td' || e.target.tagName.toLowerCase() === 'th') {
                   var current = e.target.parentElement;
                   var firstInput = current.firstElementChild.firstElementChild;
//
                    if(firstInput.checked) {
                        firstInput.checked = false;
                    } else {
                        firstInput.checked = true;
                    }
               }

            }

            //全选
            input[0].onclick = function() {
                input[1].checked = false;
                input[0].checked = true;
                if (input[0] = true) {
                    for (var i = 2; i < input.length; i++) {
                        input[i].checked = true;
                    }
                }
            }

            //反选
            input[1].onclick = function() {
//                clearInterval(clearit);
                input[0].checked = false;
                input[1].checked = true;
                for (var j = 2; j < input.length; j++) {
                    input[j].checked = ! input[j].checked;
                }
            }

            //定时检查全选的数量以显示行的背景色和全反选按钮
            function checkcheck() {
                var k = 1;
                for (var j = 2, len = input.length; j < len; j++) {

                    //全选、反选按钮显示
                    if (input[j].checked == false) {
                        input[0].checked = false;
                    }
                    if (input[j].checked == true) {
                        //显示行的背景色
                        input[j].parentElement.parentElement.style.backgroundColor = 'yellow';
                        k++;
                        if (k == (len-2)) {
                            //判断全选的数量
                            input[1].checked = false;
                            input[0].checked = true;
                        }
                        if (j == (len-2)) {
                            //非全选，重置 K
                            k = 0;
                        }
                    }
                    else {
                        //显示行的背景色
                        input[j].parentElement.parentElement.style.backgroundColor = '';
                    }
                };
            }
            setInterval(checkcheck,80);

        }
    </script>
</head>
<body>
    <p><input type="checkbox">全选 <input type="checkbox">反选</p>
    <table id="table">
        <tr>
            <th><input type="checkbox"></th>
            <th>姓名</th>
            <th>昵称</th>
            <th>性别</th>
        </tr>
        <tr>
            <td><input type="checkbox"></td>
            <td>张三</td>
            <td>印度阿三</td>
            <td>不明</td>
        </tr>
        <tr>
            <td><input type="checkbox"></td>
            <td>张三</td>
            <td>印度阿三</td>
            <td>不明</td>
        </tr>
        <tr>
            <td><input type="checkbox"></td>
            <td>张三</td>
            <td>印度阿三</td>
            <td>不明</td>
        </tr>
        <tr>
            <td><input type="checkbox"></td>
            <td>张三</td>
            <td>印度阿三</td>
            <td>不明</td>
        </tr>
        <tr>
            <td><input type="checkbox"></td>
            <td>张三</td>
            <td>印度阿三</td>
            <td>不明</td>
        </tr>
    </table>

</body>
</html>